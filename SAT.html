<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login & Attendance Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-50 min-h-screen p-6 font-sans">

  <!-- Login Section -->
  <div id="loginSection" class="max-w-md mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-2xl font-bold mb-4 text-blue-700 text-center">🔐 Login</h2>
    <form id="loginForm" class="flex flex-col gap-4">
      <input type="text" id="username" required placeholder="Username"
             class="px-4 py-2 border border-blue-300 rounded focus:outline-none" />
      <input type="password" id="password" required placeholder="Password"
             class="px-4 py-2 border border-blue-300 rounded focus:outline-none" />
      <button type="submit"
              class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Login</button>
    </form>
  </div>

  <!-- Attendance Tracker Section -->
  <div id="attendanceSection" class="hidden max-w-6xl mx-auto mt-10">
    <h1 class="text-4xl font-bold text-center text-blue-700 mb-6">📘 Student Attendance Tracker</h1>

    <!-- Attendance Form -->
    <form id="attendanceForm" class="flex flex-col sm:flex-row flex-wrap gap-4 mb-6 items-center">
      <input id="name" required placeholder="Student Name"
             class="px-4 py-2 border border-blue-300 rounded w-full sm:w-1/4 focus:outline-none" />
      <input id="date" type="date" required
             class="px-4 py-2 border border-blue-300 rounded w-full sm:w-1/4 focus:outline-none" />
      <input id="subject" required placeholder="Subject Name"
             class="px-4 py-2 border border-blue-300 rounded w-full sm:w-1/4 focus:outline-none" />
      <input id="teacher" required placeholder="Subject Teacher"
             class="px-4 py-2 border border-blue-300 rounded w-full sm:w-1/4 focus:outline-none" />
      <select id="status" class="px-4 py-2 border border-blue-300 rounded w-full sm:w-1/4">
        <option value="Present">Present</option>
        <option value="Absent">Absent</option>
      </select>
      <button type="submit"
              class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition" id="submitBtn">Save</button>
    </form>

    <!-- Filter Controls -->
    <div class="flex flex-col sm:flex-row gap-4 mb-6">
      <input id="filterName" placeholder="Filter by name"
             class="px-4 py-2 border border-gray-300 rounded w-full sm:w-1/3 focus:outline-none" />
      <input id="filterDate" type="date"
             class="px-4 py-2 border border-gray-300 rounded w-full sm:w-1/3 focus:outline-none" />
      <select id="filterStatus"
              class="px-4 py-2 border border-gray-300 rounded w-full sm:w-1/3">
        <option value="">All Statuses</option>
        <option value="Present">Present</option>
        <option value="Absent">Absent</option>
      </select>
    </div>

    <!-- Attendance Table -->
    <div class="bg-white rounded shadow overflow-x-auto">
      <table class="min-w-full text-left border border-gray-200" id="attendanceTable">
        <thead class="bg-blue-100 text-blue-800">
          <tr>
            <th class="p-3">Student Name</th>
            <th class="p-3">Date</th>
            <th class="p-3">Subject</th>
            <th class="p-3">Teacher</th>
            <th class="p-3">Status</th>
            <th class="p-3">Actions</th>
          </tr>
        </thead>
        <tbody id="attendanceBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    // Login Logic
    const loginForm = document.getElementById('loginForm');
    const loginSection = document.getElementById('loginSection');
    const attendanceSection = document.getElementById('attendanceSection');

    loginForm.onsubmit = (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      if (username === 'admin' && password === '1234') {
        loginSection.classList.add('hidden');
        attendanceSection.classList.remove('hidden');
      } else {
        alert('Invalid credentials. Try admin / 1234');
      }
    };

    // Attendance Logic
    const form = document.getElementById('attendanceForm');
    const nameInput = document.getElementById('name');
    const dateInput = document.getElementById('date');
    const subjectInput = document.getElementById('subject');
    const teacherInput = document.getElementById('teacher');
    const statusInput = document.getElementById('status');
    const tbody = document.getElementById('attendanceBody');
    const submitBtn = document.getElementById('submitBtn');

    const filterName = document.getElementById('filterName');
    const filterDate = document.getElementById('filterDate');
    const filterStatus = document.getElementById('filterStatus');

    let attendance = JSON.parse(localStorage.getItem('attendance')) || [];
    let editIndex = -1;

    function saveToLocalStorage() {
      localStorage.setItem('attendance', JSON.stringify(attendance));
    }

    function renderTable() {
      tbody.innerHTML = '';

      const nameFilter = filterName.value.toLowerCase();
      const dateFilter = filterDate.value;
      const statusFilter = filterStatus.value;

      const filtered = attendance.filter(entry => {
        return (
          (nameFilter === '' || entry.name.toLowerCase().includes(nameFilter)) &&
          (dateFilter === '' || entry.date === dateFilter) &&
          (statusFilter === '' || entry.status === statusFilter)
        );
      });

      filtered.forEach((entry, index) => {
        const tr = document.createElement('tr');
        tr.className = "border-t hover:bg-blue-50";
        tr.innerHTML = `
          <td class="p-3">${entry.name}</td>
          <td class="p-3">${entry.date}</td>
          <td class="p-3">${entry.subject}</td>
          <td class="p-3">${entry.teacher}</td>
          <td class="p-3">${entry.status}</td>
          <td class="p-3 flex gap-2">
            <button onclick="editEntry(${index})"
                    class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">Edit</button>
            <button onclick="deleteEntry('${entry.name}', '${entry.date}')"
                    class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function deleteEntry(name, date) {
      attendance = attendance.filter(entry => !(entry.name === name && entry.date === date));
      saveToLocalStorage();
      renderTable();
    }

    function editEntry(index) {
      const entry = attendance[index];
      nameInput.value = entry.name;
      dateInput.value = entry.date;
      subjectInput.value = entry.subject;
      teacherInput.value = entry.teacher;
      statusInput.value = entry.status;
      submitBtn.textContent = "Update";
      editIndex = index;
    }

    form.onsubmit = (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const date = dateInput.value;
      const subject = subjectInput.value.trim();
      const teacher = teacherInput.value.trim();
      const status = statusInput.value;

      if (!name || !date || !subject || !teacher) return;

      if (editIndex !== -1) {
        attendance[editIndex] = { name, date, subject, teacher, status };
        editIndex = -1;
        submitBtn.textContent = "Save";
      } else {
        const index = attendance.findIndex(entry => entry.name === name && entry.date === date);
        if (index !== -1) {
          attendance[index] = { name, date, subject, teacher, status };
        } else {
          attendance.push({ name, date, subject, teacher, status });
        }
      }

      saveToLocalStorage();
      renderTable();
      form.reset();
      dateInput.valueAsDate = new Date();
    };

    dateInput.valueAsDate = new Date();
    filterName.addEventListener('input', renderTable);
    filterDate.addEventListener('change', renderTable);
    filterStatus.addEventListener('change', renderTable);
    renderTable();
  </script>
</body>
</html>